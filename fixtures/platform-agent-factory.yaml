apiVersion: platform.althq.com/v1
kind: Service
metadata:
  name: agent-factory
  description: Autonomous AI agent platform. TanStack Start app + Fargate autonomous tasks + EFS agent memory.

spec:
  compute:
    type: ecs
    port: 3000
    cpu: 512
    memory: 1024
    instances:
      min: 1
    healthCheck:
      path: /health
    publicPaths:
      - /webhooks/*

  dynamodb:
    tables:
      - name: agent-factory-agents
        partitionKey: agent_id
      - name: agent-factory-jobs
        partitionKey: job_id
        ttlAttribute: expires_at
      - name: agent-factory-conversations
        partitionKey: agent_id
        sortKey: session_sk
        ttlAttribute: expires_at

  storage:
    efs:
      encrypted: true
      lifecycle: AFTER_30_DAYS
      accessPoint:
        path: /agent-factory
        uid: 1000
        gid: 1000

  serviceDiscovery:
    namespace: agents.local

  eventbridge:
    scheduleGroup: agent-factory

  secrets:
    - ANTHROPIC_API_KEY
    - GITHUB_PAT
    - MEMORY_REPO_URL
